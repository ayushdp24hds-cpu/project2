<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hospital Management - Single File Demo</title>
  <style>
    /* Simple reset & layout */
    :root{--accent:#0b74de;--muted:#666}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Arial;line-height:1.4;margin:0;color:#111}
    header{background:linear-gradient(90deg,#0b74de 0%, #2aa7ff 100%);color:#fff;padding:18px 20px}
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:#fff;color:var(--accent);padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.25)}

    main{display:grid;grid-template-columns:280px 1fr;gap:20px;margin-top:20px}
    aside{background:#f7f9fc;padding:14px;border-radius:10px;min-height:400px}
    .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(18,38,63,0.06)}
    .nav-item{display:block;padding:10px;border-radius:8px;color:var(--muted);text-decoration:none;margin-bottom:6px}
    .nav-item.active{background:linear-gradient(90deg,#eef8ff,#f6fbff);color:var(--accent);font-weight:700}

    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .search{display:flex;gap:8px}
    input[type="search"], input[type="text"], select{padding:8px;border-radius:8px;border:1px solid #e3e8ef}

    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f0f2f6;text-align:left;font-size:14px}
    th{color:var(--muted);font-weight:700}
    .small{font-size:13px;color:var(--muted)}

    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{display:block;font-size:13px;margin-bottom:6px}
    .row{Margin-bottom:10px}

    .actions{display:flex;gap:6px}
    .pill{padding:6px 8px;border-radius:8px;border:none;cursor:pointer}
    .pill.edit{background:#fff;border:1px solid #e3e8ef}
    .pill.delete{background:#ffecec;border:1px solid #ffbcbc;color:#b00000}

    footer{margin-top:30px;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:900px){main{grid-template-columns:1fr}aside{order:2}}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h1 style="margin:0;font-size:20px">Hospital Management — Demo</h1>
          <div class="small">Single-file HTML/CSS/JS demo with localStorage CRUD</div>
        </div>
        <div>
          <nav>
            <!-- Buttons hidden visually per your request, but kept in DOM so export/import code still works -->
            <button class="btn" id="exportBtn" style="display:none">Export JSON</button>
            <button class="btn" id="importBtn" style="display:none">Import JSON</button>
            <input id="fileInput" type="file" accept="application/json" style="display:none" />
          </nav>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <main>
      <aside class="card">
        <nav>
          <a href="#" class="nav-item active" data-target="dashboard">Dashboard</a>
          <a href="#" class="nav-item" data-target="patients">Patients</a>
          <a href="#" class="nav-item" data-target="doctors">Doctors</a>
          <a href="#" class="nav-item" data-target="appointments">Appointments</a>
          <a href="#" class="nav-item" data-target="billing">Billing</a>
          <a href="#" class="nav-item" data-target="settings">Settings</a>
        </nav>
      </aside>

      <section id="contentArea">
        <!-- Dashboard -->
        <div class="card" data-panel="dashboard">
          <div class="topbar">
            <div>
              <h2 style="margin:0">Dashboard</h2>
              <div class="small">A quick overview</div>
            </div>
            <div class="search">
              <input id="globalSearch" type="search" placeholder="Search patients, doctors, appointments..." />
            </div>
          </div>

          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
            <div class="card small" style="text-align:center">
              <div style="font-size:28px" id="countPatients">0</div>
              <div>Patients</div>
            </div>
            <div class="card small" style="text-align:center">
              <div style="font-size:28px" id="countDoctors">0</div>
              <div>Doctors</div>
            </div>
            <div class="card small" style="text-align:center">
              <div style="font-size:28px" id="countAppointments">0</div>
              <div>Appointments</div>
            </div>
          </div>

          <div style="margin-top:14px">
            <h3 style="margin:0 0 8px 0">Recent appointments</h3>
            <table id="recentAppointments">
              <thead><tr><th>When</th><th>Patient</th><th>Doctor</th><th>Status</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Patients -->
        <div class="card" data-panel="patients" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 style="margin:0">Patients</h2>
              <div class="small">Manage patient records</div>
            </div>
            <div>
              <button class="btn" id="addPatientBtn">+ Add patient</button>
            </div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="small">Filter & Search</div>
              <div style="display:flex;gap:8px">
                <input id="patientSearch" placeholder="Search by name or phone" />
                <select id="patientSort"><option value="new">Newest</option><option value="old">Oldest</option></select>
              </div>
            </div>
          </div>

          <div class="card">
            <table id="patientsTable">
              <thead><tr><th>Name</th><th>Age</th><th>Phone</th><th>Notes</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Doctors -->
        <div class="card" data-panel="doctors" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 style="margin:0">Doctors</h2>
              <div class="small">Manage doctor profiles</div>
            </div>
            <div>
              <button class="btn" id="addDoctorBtn">+ Add doctor</button>
            </div>
          </div>

          <div class="card">
            <table id="doctorsTable">
              <thead><tr><th>Name</th><th>Speciality</th><th>Phone</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Appointments -->
        <div class="card" data-panel="appointments" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 style="margin:0">Appointments</h2>
              <div class="small">Schedule and track appointments</div>
            </div>
            <div>
              <button class="btn" id="addAppointmentBtn">+ New appointment</button>
            </div>
          </div>

          <div class="card">
            <table id="appointmentsTable">
              <thead><tr><th>Date & Time</th><th>Patient</th><th>Doctor</th><th>Status</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Billing -->
        <div class="card" data-panel="billing" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 style="margin:0">Billing</h2>
              <div class="small">Create quick bills / invoices</div>
            </div>
            <div>
              <button class="btn" id="newBillBtn">+ New bill</button>
            </div>
          </div>

          <div class="card">
            <table id="billsTable">
              <thead><tr><th>Bill #</th><th>Patient</th><th>Amount</th><th>Status</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Settings -->
        <div class="card" data-panel="settings" style="display:none">
          <h2 style="margin-top:0">Settings</h2>
          <div class="small">This demo stores data in your browser. Clearing site data will remove saved records.</div>
          <div style="margin-top:12px"><button class="btn" id="resetBtn">Reset demo data</button></div>
        </div>

      </section>

    </main>

    <footer class="container">
      <div class="small">Built for demo / college project — Save this page as <code>hospital_management.html</code> and open in a browser.</div>
    </footer>
  </div>

  <!-- Modals (simple implemention using prompt for brevity) -->

  <script>
    // Simple localStorage-backed storage keys
    const KEY_PATIENTS = 'hms_patients_v1';
    const KEY_DOCTORS = 'hms_doctors_v1';
    const KEY_APPTS = 'hms_appts_v1';
    const KEY_BILLS = 'hms_bills_v1';

    // Utility helpers
    const uid = ()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7);
    const load = (k)=> JSON.parse(localStorage.getItem(k) || '[]');
    const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));

    // Initial demo seed if empty
    function seedIfEmpty(){
      if(load(KEY_PATIENTS).length===0){
        save(KEY_PATIENTS,[{id:uid(),name:'Rahul Sharma',age:35,phone:'9876543210',notes:'Diabetic'},{id:uid(),name:'Sita Devi',age:28,phone:'9123456780',notes:'Regular checkup'}]);
      }
      if(load(KEY_DOCTORS).length===0){
        save(KEY_DOCTORS,[{id:uid(),name:'Dr. A. Kulkarni',speciality:'Cardiology',phone:'9000000001'},{id:uid(),name:'Dr. N. Desai',speciality:'Orthopedics',phone:'9000000002'}]);
      }
      if(load(KEY_APPTS).length===0){
        const patients=load(KEY_PATIENTS);const doctors=load(KEY_DOCTORS);
        save(KEY_APPTS,[{id:uid(),patientId:patients[0].id,doctorId:doctors[0].id,when:new Date().toISOString(),status:'Scheduled'}]);
      }
      if(load(KEY_BILLS).length===0){save(KEY_BILLS,[]);}    
    }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(a=>a.addEventListener('click',ev=>{
      ev.preventDefault();
      document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
      a.classList.add('active');
      const target = a.dataset.target;
      document.querySelectorAll('[data-panel]').forEach(p=>p.style.display = p.dataset.panel===target?'block':'none');
      renderAll();
    }));

    // Basic rendering functions
    function renderAll(){
      renderCounts(); renderRecentAppointments(); renderPatients(); renderDoctors(); renderAppointments(); renderBills();
    }
    function renderCounts(){
      document.getElementById('countPatients').textContent = load(KEY_PATIENTS).length;
      document.getElementById('countDoctors').textContent = load(KEY_DOCTORS).length;
      document.getElementById('countAppointments').textContent = load(KEY_APPTS).length;
    }
    function renderRecentAppointments(){
      const rows = load(KEY_APPTS).slice().sort((a,b)=>new Date(b.when)-new Date(a.when)).slice(0,6);
      const tbody=document.querySelector('#recentAppointments tbody'); tbody.innerHTML='';
      const patients=load(KEY_PATIENTS); const doctors=load(KEY_DOCTORS);
      rows.forEach(r=>{
        const p = patients.find(x=>x.id===r.patientId)?.name||'Unknown';
        const d = doctors.find(x=>x.id===r.doctorId)?.name||'Unknown';
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${new Date(r.when).toLocaleString()}</td><td>${p}</td><td>${d}</td><td>${r.status}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Patients
    function renderPatients(){
      const t = document.querySelector('#patientsTable tbody'); t.innerHTML='';
      const patients = load(KEY_PATIENTS);
      const q = document.getElementById('patientSearch')?.value?.toLowerCase()||'';
      const sort = document.getElementById('patientSort')?.value||'new';
      let list = patients.filter(p=>p.name.toLowerCase().includes(q) || p.phone?.includes(q));
      list.sort((a,b)=> sort==='new' ? (b.id.localeCompare(a.id)) : a.id.localeCompare(b.id));
      list.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.name}</td><td>${p.age||''}</td><td>${p.phone||''}</td><td class="small">${p.notes||''}</td><td class="actions"><button class="pill edit" data-id="${p.id}" data-type="p-edit">Edit</button><button class="pill delete" data-id="${p.id}" data-type="p-del">Delete</button></td>`;
        t.appendChild(tr);
      });
    }

    // Doctors
    function renderDoctors(){
      const t = document.querySelector('#doctorsTable tbody'); t.innerHTML='';
      const doctors = load(KEY_DOCTORS);
      doctors.forEach(d=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.name}</td><td>${d.speciality||''}</td><td>${d.phone||''}</td><td class="actions"><button class="pill edit" data-id="${d.id}" data-type="d-edit">Edit</button><button class="pill delete" data-id="${d.id}" data-type="d-del">Delete</button></td>`;
        t.appendChild(tr);
      });
    }

    // Appointments
    function renderAppointments(){
      const t = document.querySelector('#appointmentsTable tbody'); t.innerHTML='';
      const appts = load(KEY_APPTS).slice().sort((a,b)=>new Date(b.when)-new Date(a.when));
      const patients=load(KEY_PATIENTS); const doctors=load(KEY_DOCTORS);
      appts.forEach(a=>{
        const p = patients.find(x=>x.id===a.patientId)?.name||'Unknown';
        const d = doctors.find(x=>x.id===a.doctorId)?.name||'Unknown';
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${new Date(a.when).toLocaleString()}</td><td>${p}</td><td>${d}</td><td>${a.status||'Scheduled'}</td><td class="actions"><button class="pill edit" data-id="${a.id}" data-type="a-edit">Edit</button><button class="pill delete" data-id="${a.id}" data-type="a-del">Delete</button></td>`;
        t.appendChild(tr);
      });
    }

    // Bills
    function renderBills(){
      const t = document.querySelector('#billsTable tbody'); t.innerHTML='';
      const bills = load(KEY_BILLS).slice().sort((a,b)=>b.createdAt-a.createdAt);
      const patients=load(KEY_PATIENTS);
      bills.forEach(b=>{
        const p = patients.find(x=>x.id===b.patientId)?.name||'Unknown';
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${b.id}</td><td>${p}</td><td>₹${b.amount.toFixed(2)}</td><td>${b.status||'Unpaid'}</td><td class="actions"><button class="pill edit" data-id="${b.id}" data-type="b-view">View</button></td>`;
        t.appendChild(tr);
      });
    }

    // Global event delegation for table actions
    document.addEventListener('click', ev=>{
      const t = ev.target;
      if(t.dataset.type){
        const type = t.dataset.type; const id=t.dataset.id;
        if(type==='p-del'){ if(confirm('Delete patient? This will not remove appointments automatically.')){ let arr=load(KEY_PATIENTS); arr=arr.filter(x=>x.id!==id); save(KEY_PATIENTS,arr); renderAll(); }}
        if(type==='p-edit'){ editPatient(id); }
        if(type==='d-del'){ if(confirm('Delete doctor?')){ let arr=load(KEY_DOCTORS); arr=arr.filter(x=>x.id!==id); save(KEY_DOCTORS,arr); renderAll(); }}
        if(type==='d-edit'){ editDoctor(id); }
        if(type==='a-del'){ if(confirm('Delete appointment?')){ let arr=load(KEY_APPTS); arr=arr.filter(x=>x.id!==id); save(KEY_APPTS,arr); renderAll(); }}
        if(type==='a-edit'){ editAppointment(id); }
        if(type==='b-view'){ alert('Viewing bill: '+id); }
      }
    });

    // Forms via prompt (keeps single-file compact) - for a real project replace with proper modals
    document.getElementById('addPatientBtn').addEventListener('click',()=>{
      const name=prompt('Patient name'); if(!name) return; const age=prompt('Age (optional)'); const phone=prompt('Phone (optional)'); const notes=prompt('Notes (optional)');
      const patients=load(KEY_PATIENTS); patients.push({id:uid(),name,age:age?Number(age):null,phone,notes}); save(KEY_PATIENTS,patients); renderAll();
    });
    function editPatient(id){ const patients=load(KEY_PATIENTS); const p=patients.find(x=>x.id===id); if(!p) return alert('Not found');
      const name=prompt('Patient name',p.name); if(!name) return; const age=prompt('Age (optional)',p.age||''); const phone=prompt('Phone',p.phone||''); const notes=prompt('Notes',p.notes||'');
      p.name=name; p.age=age?Number(age):null; p.phone=phone; p.notes=notes; save(KEY_PATIENTS,patients); renderAll(); }

    document.getElementById('addDoctorBtn').addEventListener('click',()=>{
      const name=prompt('Doctor name'); if(!name) return; const speciality=prompt('Speciality (eg. Cardiology)'); const phone=prompt('Phone');
      const arr=load(KEY_DOCTORS); arr.push({id:uid(),name,speciality,phone}); save(KEY_DOCTORS,arr); renderAll();
    });
    function editDoctor(id){ const arr=load(KEY_DOCTORS); const d=arr.find(x=>x.id===id); if(!d) return; const name=prompt('Doctor name',d.name); if(!name) return; const speciality=prompt('Speciality',d.speciality||''); const phone=prompt('Phone',d.phone||''); d.name=name; d.speciality=speciality; d.phone=phone; save(KEY_DOCTORS,arr); renderAll(); }

    document.getElementById('addAppointmentBtn').addEventListener('click',()=>{
      const patients=load(KEY_PATIENTS); const doctors=load(KEY_DOCTORS);
      if(!patients.length||!doctors.length) return alert('Add at least one patient and one doctor first.');
      const p = prompt('Enter patient name (exact)'); const patient = patients.find(x=>x.name.toLowerCase()===p?.toLowerCase()); if(!patient) return alert('Patient not found');
      const d = prompt('Enter doctor name (exact)'); const doctor = doctors.find(x=>x.name.toLowerCase()===d?.toLowerCase()); if(!doctor) return alert('Doctor not found');
      const when = prompt('Date & time (YYYY-MM-DD HH:MM)', new Date().toISOString().slice(0,16).replace('T',' ')); if(!when) return;
      const appts=load(KEY_APPTS); appts.push({id:uid(),patientId:patient.id,doctorId:doctor.id,when:new Date(when).toISOString(),status:'Scheduled'}); save(KEY_APPTS,appts); renderAll();
    });
    function editAppointment(id){ const arr=load(KEY_APPTS); const a=arr.find(x=>x.id===id); if(!a) return; const when=prompt('Date & time (YYYY-MM-DD HH:MM)', new Date(a.when).toISOString().slice(0,16).replace('T',' ')); if(!when) return; const status=prompt('Status (Scheduled / Done / Cancelled)', a.status||'Scheduled'); a.when=new Date(when).toISOString(); a.status=status; save(KEY_APPTS,arr); renderAll(); }

    document.getElementById('newBillBtn')?.addEventListener('click',()=>{
      const patients=load(KEY_PATIENTS); if(!patients.length) return alert('No patients');
      const p = prompt('Patient name (exact)'); const patient = patients.find(x=>x.name.toLowerCase()===p?.toLowerCase()); if(!patient) return alert('Patient not found');
      const amount = Number(prompt('Amount (in INR)')); if(isNaN(amount)) return alert('Invalid amount');
      const bills = load(KEY_BILLS); const bill = {id:'B'+uid().slice(2,9).toUpperCase(),patientId:patient.id,amount,createdAt:Date.now(),status:'Unpaid'}; bills.push(bill); save(KEY_BILLS,bills); renderAll();
    });

    // Search inputs
    document.getElementById('patientSearch').addEventListener('input',()=>renderPatients());
    document.getElementById('patientSort').addEventListener('change',()=>renderPatients());
    document.getElementById('globalSearch').addEventListener('input',ev=>{
      const q = ev.target.value.toLowerCase();
      // simple filter: highlight counts by filtering lists
      // For brevity we'll not filter UI panels here; user can navigate and use panel-specific search
    });

    // Export/Import
    document.getElementById('exportBtn').addEventListener('click',()=>{
      const data = {patients:load(KEY_PATIENTS),doctors:load(KEY_DOCTORS),appointments:load(KEY_APPTS),bills:load(KEY_BILLS)};
      const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='hms_export_'+new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')+'.json'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('importBtn').addEventListener('click',()=>document.getElementById('fileInput').click());
    document.getElementById('fileInput').addEventListener('change',ev=>{
      const f = ev.target.files[0]; if(!f) return; const r=new FileReader(); r.onload = e=>{
        try{ const data = JSON.parse(e.target.result); if(data.patients) save(KEY_PATIENTS,data.patients); if(data.doctors) save(KEY_DOCTORS,data.doctors); if(data.appointments) save(KEY_APPTS,data.appointments); if(data.bills) save(KEY_BILLS,data.bills); alert('Import successful'); renderAll(); }catch(err){alert('Invalid file')}
      }; r.readAsText(f);
    });

    // Reset demo
    document.getElementById('resetBtn').addEventListener('click',()=>{ if(confirm('Reset all demo data?')){ localStorage.removeItem(KEY_PATIENTS); localStorage.removeItem(KEY_DOCTORS); localStorage.removeItem(KEY_APPTS); localStorage.removeItem(KEY_BILLS); seedIfEmpty(); renderAll(); } });

    // Initialize
    seedIfEmpty(); renderAll();

  </script>
</body>
</html>
